openapi: 3.0.3
info:
  title: My API
  version: 1.0.0
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    cookieAuth:
      type: apiKey
      in: cookie
      name: refreshToken
    AppClientAuth:
      type: apiKey
      in: header
      name: X-App-Secret
  schemas:
    def-0:
      type: object
      properties:
        username:
          type: string
        password:
          type: string
      required:
        - username
        - password
      title: authCredentialsBody
    def-1:
      additionalProperties: false
      properties:
        error:
          type: string
        message:
          type: string
      type: object
      title: errorResponse
    def-2:
      type: object
      properties:
        username:
          type: string
          minLength: 3
          maxLength: 20
        password:
          type: string
          minLength: 8
      required:
        - username
        - password
      title: SignupBody
    def-3:
      description: OK
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
      required:
        - success
        - message
      title: SuccessMessageResponse
    def-4:
      type: object
      required:
        - winner_id
        - loser_id
        - winner_score
        - loser_score
        - date
      properties:
        winner_id:
          type: integer
        loser_id:
          type: integer
        winner_score:
          type: integer
        loser_score:
          type: integer
        date:
          type: string
          format: date-time
      title: matchObject
    def-5:
      type: object
      required:
        - id
      properties:
        id:
          type: integer
      title: userIdObject
    def-6:
      type: object
      required:
        - id
        - username
        - avatar
      properties:
        id:
          type: integer
        username:
          type: string
        avatar:
          type:
            - "null"
            - string
        is_active:
          type: boolean
      title: publicUserObject
paths:
  /matches:
    post:
      tags:
        - matches
      description: Records a completed match between two users, including winner,
        loser, scores, and match date. `This endpoint requires client
        authentication.`
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/def-4"
      security: &a1
        - AppClientAuth: []
      responses:
        "200":
          description: Uploaded new match successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-3"
        "400":
          description: "Bad Request: Invalid input or missing fields"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "401":
          description: "Unauthorized: Invalid credentials"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
    get:
      tags:
        - matches
      description: Returns a list of all matches. `This endpoint requires client
        authentication.`
      security: *a1
      responses:
        "200":
          description: Default Response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/def-4"
        "401":
          description: "Unauthorized: Invalid credentials"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
  /users/{id}/matches:
    get:
      tags:
        - matches
      description: Returns a list of all the matches of a user using the user_id
        parameter. `This endpoint requires client authentication.`
      parameters:
        - schema:
            type: integer
          in: path
          name: id
          required: true
      security: *a1
      responses:
        "200":
          description: Default Response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/def-4"
        "401":
          description: "Unauthorized: Invalid credentials"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "404":
          description: "Not Found: User not found"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
  /users:
    get:
      tags:
        - user
      description: Returns a list of all registered users. `This endpoint requires
        client authentication.`
      security: *a1
      responses:
        "200":
          description: Default Response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/def-6"
  /users/{id}:
    get:
      tags:
        - user
      description: Returns an object of an user using the id passed in parameters.
        `This endpoint requires client authentication.`
      parameters:
        - schema:
            type: integer
          in: path
          name: id
          required: true
      security: *a1
      responses:
        "200":
          description: Default Response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-6"
        "400":
          description: "Bad Request: Invalid input or missing fields"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "401":
          description: "Unauthorized: Invalid credentials"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "404":
          description: "Not Found: User not found"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                description: Internal Server Error
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
  /users/signup:
    post:
      tags:
        - auth
      description: Creates a new user account using a username and password. Does not
        automatically log in the user.
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/def-2"
      responses:
        "201":
          description: Signed up user successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-3"
        "400":
          description: "Bad Request: Invalid input or missing fields"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "409":
          description: "Conflict: Username already exists"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
  /users/me/password:
    put:
      tags:
        - user
      description: Modifies the password of the user. `This endpoint requires client
        AND user authentication.`
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - oldPassword
                - newPassword
              properties:
                oldPassword:
                  type: string
                newPassword:
                  type: string
                  minLength: 8
              additionalProperties: false
        required: true
      security: &a2
        - BearerAuth: []
          AppClientAuth: []
      responses:
        "200":
          description: Updated password successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-3"
        "400":
          description: "Bad Request: Invalid input or missing fields"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "401":
          description: "Unauthorized: Invalid credentials"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
  /users/me/avatar:
    put:
      tags:
        - user
      description: Modifies the avatar of the user. `This endpoint requires client AND
        user authentication.`
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - avatar
              properties:
                avatar:
                  type: string
                  format: binary
        required: true
      security: *a2
      responses:
        "200":
          description: Updated avatar successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-3"
        "400":
          description: "Bad Request: Invalid input or missing fields"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "401":
          description: "Unauthorized: Invalid credentials"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
    delete:
      tags:
        - user
      description: Deletes the avatar of the user. `This endpoint requires client AND
        user authentication.`
      security: *a2
      responses:
        "204":
          description: "Success: Avatar deleted successfully"
        "401":
          description: "Unauthorized: Invalid credentials"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
  /users/me/username:
    put:
      tags:
        - user
      description: Modifies the username of the user. `This endpoint requires client
        AND user authentication.`
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - new_username
              properties:
                new_username:
                  type: string
                  minLength: 3
                  maxLength: 20
              additionalProperties: false
        required: true
      security: *a2
      responses:
        "200":
          description: Updated username successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-3"
        "400":
          description: "Bad Request: Invalid input or missing fields"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "401":
          description: "Unauthorized: Invalid credentials"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "409":
          description: "Conflict: Username is taken already"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
  /users/me/friends:
    post:
      tags:
        - user
      description: Adds a new friend to the authenticated user's friend list.						The
        new friend's `id` provided in the request body is validated before the
        friendship record is created.						`This endpoint requires client
        authentication AND user authentication.`
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/def-5"
      security: *a2
      responses:
        "201":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-3"
        "400":
          description: "Bad Request: Invalid input or missing fields"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "401":
          description: "Unauthorized: Invalid credentials"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "404":
          description: "Not Found: User not found"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
    delete:
      tags:
        - user
      description: Deletes a friend from the authenticated user's friend list using
        the id passed in the body.						`This endpoint requires client
        authentication AND user authentication.`
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/def-5"
      security: *a2
      responses:
        "204":
          description: "Success: Friend deleted successfully"
        "400":
          description: "Bad Request: Invalid input or missing fields"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "401":
          description: "Unauthorized: Invalid credentials"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "404":
          description: "Not Found: User not found"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
    get:
      tags:
        - user
      description: Returns the complete list of friends of the authenticated
        user.				Returns basic profile information for each friend.				`This
        endpoint requires client authentication AND user authentication.`
      security: *a2
      responses:
        "200":
          description: Default Response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/def-6"
        "401":
          description: "Unauthorized: Invalid credentials"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "404":
          description: "Not Found: User not found"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
  /users/me:
    delete:
      tags:
        - user
      description: Deletes the user account and all its data. `This endpoint requires
        client AND user authentication.`
      security: *a2
      responses:
        "204":
          description: "Success: User deleted successfully"
        "401":
          description: "Unauthorized: Invalid credentials"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
  /users/auth/login:
    post:
      tags:
        - auth
      description: Authenticates the user using their username and password. On
        success, returns a the user's id AND short-lived access token in the
        response body and sets a long-lived refresh token in the `HttpOnly
        refreshToken cookie`, which can later be used to obtain new access
        tokens.
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/def-0"
      responses:
        "200":
          description: Default Response
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken:
                    type: string
                  id:
                    type: integer
                required:
                  - accessToken
                  - id
        "401":
          description: "Unauthorized: Invalid credentials"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
  /users/auth/refresh:
    post:
      tags:
        - auth
      description: Uses the refresh token to issue a new access token. The endpoint
        verifies the refresh token, checks that it is not expired or revoked.
        This endpoint requires `client authentification` AND `user
        authentification` AND the refresh cookie stored in the `HttpOnly
        refreshToken cookie`
      security: &a3
        - BearerAuth: []
          cookieAuth: []
          AppClientAuth: []
      responses:
        "200":
          description: Returns new access token
          content:
            application/json:
              schema:
                description: Returns new access token
                type: object
                properties:
                  accessToken:
                    type: string
                required:
                  - accessToken
        "401":
          description: "Unauthorized: Invalid credentials"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
  /users/auth/logout:
    post:
      tags:
        - auth
      description: Logs the user out by invalidating the refresh token stored in
        the 				`HttpOnly refreshToken cookie`. After logout, the user must
        reauthenticate with their				 username and password to obtain new
        tokens. This endpoint requires client authentification 				 AND user
        authentification AND the refresh cookie stored in the HttpOnly
        refreshToken cookie
      security: *a3
      responses:
        "200":
          description: "Success: User successfully logged out"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-3"
        "401":
          description: "Unauthorized: Invalid credentials"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
tags:
  - name: auth
    description: Auth endpoints
  - name: user
    description: User endpoints
  - name: matches
    description: Matches endpoints

openapi: 3.0.3
info:
  title: My API
  version: 1.0.0
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    cookieAuth:
      type: apiKey
      in: cookie
      name: refresh_token
    AppClientAuth:
      type: apiKey
      in: header
      name: X-App-Secret
  schemas:
    def-0:
      type: object
      properties:
        login:
          type: string
        password:
          type: string
      required:
        - password
        - login
      title: authCredentialsBody
    def-1:
      additionalProperties: false
      properties:
        error:
          type: string
        message:
          type: string
      required:
        - error
      type: object
      title: errorResponse
    def-2:
      type: object
      required:
        - username
        - password
        - email
      properties:
        username:
          type: string
          minLength: 3
          maxLength: 20
        password:
          type: string
          minLength: 8
        email:
          type: string
          format: email
      title: SignupBody
    def-3:
      description: OK
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
      required:
        - success
        - message
      title: SuccessMessageResponse
    def-4:
      type: object
      required:
        - winner_id
        - loser_id
        - winner_score
        - loser_score
        - date
      properties:
        winner_id:
          type: integer
        loser_id:
          type: integer
        winner_score:
          type: integer
        loser_score:
          type: integer
        date:
          type: string
          format: date-time
      title: matchObject
    def-5:
      type: object
      required:
        - id
      properties:
        id:
          type: integer
      title: userIdObject
    def-6:
      type: object
      required:
        - id
        - username
        - avatar
      properties:
        id:
          type: integer
        username:
          type: string
        avatar:
          type:
            - "null"
            - string
        is_active:
          type: boolean
        oauth:
          type: boolean
      title: publicUserObject
    def-7:
      type: object
      required:
        - accessToken
        - id
      properties:
        accessToken:
          type: string
        id:
          type: integer
      example:
        accessToken: a3f9c8e2b4d74e0c9f...
        id: 1
      description: Login successful
      title: loginTokenObject
    def-8:
      type: object
      required:
        - twoFactorRequired
        - token
      properties:
        twoFactorRequired:
          type: boolean
          example: true
        token:
          type: string
      example:
        twoFactorRequired: true
        token: a3f9c8e2b4d74e0c9f...
      description: Two-factor authentication required
      title: twoFactorRequiredObject
    def-9:
      type: object
      description: Private authenticated user data
      required:
        - id
        - username
        - email
        - avatar
        - email_verified
        - is_2fa_enabled
        - oauth_provider
        - matches
        - is_active
        - oauth
        - is_password_set
      properties:
        id:
          type: integer
          example: 1
        username:
          type: string
          minLength: 3
          maxLength: 32
          example: lasablon
        email:
          type: string
          format: email
          example: lasablon@student.42.fr
        avatar:
          type:
            - "null"
            - string
          format: uri
          example: https://localhost:8443/api/avatars/user_1.jpg
        email_verified:
          type: boolean
          description: Whether the user's email is verified
          example: true
        is_2fa_enabled:
          type: boolean
          description: Whether two-factor authentication is enabled
          example: false
        oauth_provider:
          type:
            - "null"
            - string
          description: OAuth provider used for signup
          example: "42"
        oauth:
          type: boolean
          description: Whether the user authenticated via OAuth
          example: true
        is_active:
          type: boolean
          description: Whether the user account is active
          example: true
        matches:
          type: array
          description: List of matches played by the user
          items:
            $ref: "#/components/schemas/def-4"
        is_password_set:
          type: boolean
          description: Whether the user has set a password
          example: true
      additionalProperties: false
      title: privateUserObject
paths:
  /api/matches:
    post:
      tags:
        - matches
      description: Records a completed match between two users, including winner,
        loser, scores, and match date. `This endpoint requires client
        authentication.`
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/def-4"
      security:
        - AppClientAuth: []
      responses:
        "200":
          description: Uploaded new match successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-3"
        "400":
          description: "Bad Request: Invalid input or missing fields"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "401":
          description: "Unauthorized: Invalid credentials"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
    get:
      tags:
        - matches
      description: Returns a list of all matches. `This endpoint requires client
        authentication.`
      responses:
        "200":
          description: Default Response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/def-4"
        "401":
          description: "Unauthorized: Invalid credentials"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
  /api/users/{id}/matches:
    get:
      tags:
        - matches
      description: Returns a list of all the matches of a user using the user_id
        parameter. `This endpoint requires client authentication.`
      parameters:
        - schema:
            type: integer
          in: path
          name: id
          required: true
      responses:
        "200":
          description: Default Response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/def-4"
        "401":
          description: "Unauthorized: Invalid credentials"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "404":
          description: "Not Found: User not found"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
  /api/users/me:
    get:
      tags:
        - user
      description: Returns an object of the current user data. `This endpoint requires
        user authentication.`
      security: &a1
        - BearerAuth: []
      responses:
        "200":
          description: Private authenticated user data
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-9"
        "401":
          description: "Unauthorized: Invalid credentials"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "404":
          description: "Not Found: User not found"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
    delete:
      tags:
        - user
      description: Deletes the user account and all its data. `This endpoint requires
        client AND user authentication.`
      security: *a1
      responses:
        "204":
          description: "Success: User deleted successfully"
        "401":
          description: "Unauthorized: Invalid credentials"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
  /api/users:
    get:
      tags:
        - user
      description: Returns a list of all registered users. `This endpoint requires
        client authentication.`
      responses:
        "200":
          description: Default Response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/def-6"
  /api/users/{id}:
    get:
      tags:
        - user
      description: Returns an object of an user using the id passed in parameters.
        `This endpoint requires client authentication.`
      parameters:
        - schema:
            type: integer
          in: path
          name: id
          required: true
      responses:
        "200":
          description: Default Response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-6"
        "400":
          description: "Bad Request: Invalid input or missing fields"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "401":
          description: "Unauthorized: Invalid credentials"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "404":
          description: "Not Found: User not found"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                description: Internal Server Error
                type: object
                properties:
                  error:
                    type: string
                  message:
                    type: string
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
  /api/users/me/password:
    put:
      tags:
        - user
      description: Modifies the password of the user. `This endpoint requires client
        AND user authentication.`
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - oldPassword
                - newPassword
              properties:
                oldPassword:
                  type: string
                newPassword:
                  type: string
                  minLength: 8
              additionalProperties: false
        required: true
      security: *a1
      responses:
        "200":
          description: Updated password successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-3"
        "400":
          description: "Bad Request: Invalid input or missing fields"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "401":
          description: "Unauthorized: Invalid credentials"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
    post:
      tags:
        - user
      description: Sets the password of an user that doesnt already have a password
        (oAuth signup). `This endpoint requires client AND user authentication.`
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - password
              properties:
                password:
                  type: string
                  minLength: 8
              additionalProperties: false
        required: true
      security: *a1
      responses:
        "200":
          description: Uploaded password successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-3"
        "400":
          description: "Bad Request: Invalid input or missing fields"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "401":
          description: "Unauthorized: Invalid credentials"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "403":
          description: "Forbidden: User already has a password"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
  /api/users/me/avatar:
    put:
      tags:
        - user
      description: Modifies the avatar of the user. `This endpoint requires client AND
        user authentication.`
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - avatar
              properties:
                avatar:
                  type: string
                  format: binary
        required: true
      security: *a1
      responses:
        "200":
          description: Updated avatar successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-3"
        "400":
          description: "Bad Request: Invalid input or missing fields"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "401":
          description: "Unauthorized: Invalid credentials"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "413":
          description: Payload too large
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
    delete:
      tags:
        - user
      description: Deletes the avatar of the user. `This endpoint requires client AND
        user authentication.`
      security: *a1
      responses:
        "204":
          description: "Success: Avatar deleted successfully"
        "401":
          description: "Unauthorized: Invalid credentials"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
  /api/users/me/username:
    put:
      tags:
        - user
      description: Modifies the username of the user. `This endpoint requires client
        AND user authentication.`
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - new_username
              properties:
                new_username:
                  type: string
                  minLength: 3
                  maxLength: 20
              additionalProperties: false
        required: true
      security: *a1
      responses:
        "200":
          description: Updated username successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-3"
        "400":
          description: "Bad Request: Invalid input or missing fields"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "401":
          description: "Unauthorized: Invalid credentials"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "409":
          description: "Conflict: Username is taken already"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
  /api/users/me/friends:
    post:
      tags:
        - user
      description: Adds a new friend to the authenticated user's friend list.		The new
        friend's `id` provided in the request body is validated before the
        friendship record is created.		`This endpoint requires client
        authentication AND user authentication.`
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/def-5"
      security: *a1
      responses:
        "201":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-3"
        "400":
          description: "Bad Request: Invalid input or missing fields"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "401":
          description: "Unauthorized: Invalid credentials"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "404":
          description: "Not Found: User not found"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "409":
          description: "Conflict: Friendship already exists"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
    delete:
      tags:
        - user
      description: Deletes a friend from the authenticated user's friend list using
        the id passed in the body.			`This endpoint requires client
        authentication AND user authentication.`
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/def-5"
      security: *a1
      responses:
        "204":
          description: "Success: Friend deleted successfully"
        "400":
          description: "Bad Request: Invalid input or missing fields"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "401":
          description: "Unauthorized: Invalid credentials"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "404":
          description: "Not Found: User not found"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
    get:
      tags:
        - user
      description: Returns the complete list of friends of the authenticated
        user.		Returns basic profile information for each friend.		`This
        endpoint requires client authentication AND user authentication.`
      security: *a1
      responses:
        "200":
          description: Default Response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/def-6"
        "401":
          description: "Unauthorized: Invalid credentials"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "404":
          description: "Not Found: User not found"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
  /api/users/me/2fa:
    put:
      tags:
        - user
      description: Enable or disable 2FA for the authenticated user.
      requestBody:
        content:
          application/json:
            schema:
              required:
                - enabled
              type: object
              properties:
                enabled:
                  type: boolean
        required: true
      security: *a1
      responses:
        "200":
          description: " 2FA status updated successfully "
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-3"
    get:
      tags:
        - user
      description: Returns 2fa activation status
      security: *a1
      responses:
        "200":
          description: Returns 2fa activation status
          content:
            application/json:
              schema:
                description: Returns 2fa activation status
                type: object
                required:
                  - is_2fa_enabled
                properties:
                  is_2fa_enabled:
                    type: boolean
        "401":
          description: "Unauthorized: Invalid credentials"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
  /api/users/me/change-email:
    put:
      tags:
        - user
      description: Changes the email of the user
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
        required: true
      security: *a1
      responses:
        "200":
          description: "Success: Email changed successfully"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-3"
        "400":
          description: "Bad Request: Invalid input or missing fields"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "401":
          description: "Unauthorized: Invalid credentials"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
  /api/users/confirm-email-change:
    get:
      tags:
        - user
      description: "Changes a user's email address using a `one-time token` sent by
        email.\t\t\tThe user clicks a verification link received by
        email.\t\t\tIf the token is valid and not expired, the email is marked
        as verified\t\t\tand the user is redirected to the frontend
        application.  \t\t\t"
      parameters:
        - schema:
            type: string
            example: a3f9c8e2b4d74e0c9f...
          in: query
          name: token
          required: true
          description: Email verification token sent to the user by email
      responses:
        "302":
          description: Email successfully changed. User is redirected to the frontend.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-3"
        "400":
          description: "Bad Request: Invalid input or missing fields"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
  /api/users/signup:
    post:
      tags:
        - auth
      description: Creates a new user account using a username an email and password.
        Sends a verification email to the user.				 Does not automatically log
        in the user.
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/def-2"
      responses:
        "201":
          description: Signed up user successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-3"
        "400":
          description: "Bad Request: Invalid input or missing fields"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "409":
          description: "Conflict: Username already exists"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
  /api/users/auth/login:
    post:
      tags:
        - auth
      description: Authenticates the user using their login (email or username) and
        password.    If authentication succeeds and two-factor authentication
        (2FA) is disabled,    the endpoint returns the user's id and a
        short-lived access token in the response body    and sets a long-lived
        refresh token in an HttpOnly `refreshToken` cookie.       If 2FA is
        enabled for the user, the endpoint does not issue tokens
        immediately.    Instead, a one-time 6-digit verification code is sent to
        the user's email and    a boolean value is returned to indicate that the
        authentication process continues    by calling the `two-factor login`
        endpoint.    `This endpoint requires the client to have a verified email
        address.`
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/def-0"
      responses:
        "200":
          description: Login successful or 2FA required
          content:
            application/json:
              schema:
                oneOf:
                  - description: Login successful
                    type: object
                    required:
                      - accessToken
                      - id
                    properties:
                      accessToken:
                        type: string
                      id:
                        type: integer
                  - description: Two-factor authentication required
                    type: object
                    required:
                      - twoFactorRequired
                    properties:
                      twoFactorRequired:
                        type: boolean
                        example: true
              examples:
                noTwoFaExample:
                  summary: Successful response when no 2FA is required
                  value:
                    accessToken: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                    id: 12
                twoFaExample:
                  summary: Successful response when 2FA is required
                  value:
                    twoFactorRequired: true
        "302":
          description: "Redirect: Email not verified"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-3"
        "401":
          description: "Unauthorized: Invalid credentials"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "403":
          description: "Forbidden: Email not verified"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
  /api/users/auth/refresh:
    post:
      tags:
        - auth
      description: Uses the refresh token to issue a new access token. The endpoint
        verifies the refresh token, checks that it is not expired or revoked.
        This endpoint requires `client authentification` AND `user
        authentification` AND the refresh cookie stored in the `HttpOnly
        refreshToken cookie`
      security: &a2
        - cookieAuth: []
      responses:
        "200":
          description: Returns new access token
          content:
            application/json:
              schema:
                description: Returns new access token
                type: object
                properties:
                  accessToken:
                    type: string
                  id:
                    type: integer
                required:
                  - accessToken
        "401":
          description: "Unauthorized: Invalid credentials"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
  /api/users/auth/logout:
    post:
      tags:
        - auth
      description: Logs the user out by invalidating the refresh token stored in
        the 				`HttpOnly refreshToken cookie`. After logout, the user must
        reauthenticate with their				 username and password to obtain new
        tokens. This endpoint requires client authentification 				 AND user
        authentification AND the refresh cookie stored in the HttpOnly
        refreshToken cookie
      security: *a2
      responses:
        "200":
          description: "Success: User successfully logged out"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-3"
        "401":
          description: "Unauthorized: Invalid credentials"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
  /api/users/auth/verify-email:
    get:
      tags:
        - auth
      description: "Verifies a user's email address using a `one-time token` sent by
        email.\t\t\tThe user clicks a verification link received by
        email.\t\t\tIf the token is valid and not expired, the email is marked
        as verified\t\t\tand the user is redirected to the frontend
        application.  \t\t\t"
      parameters:
        - schema:
            type: string
            example: a3f9c8e2b4d74e0c9f...
          in: query
          name: token
          required: true
          description: Email verification token sent to the user by email
      responses:
        "302":
          description: Email successfully verified. User is redirected to the frontend.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-3"
        "400":
          description: "Bad Request: Invalid input or missing fields"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
  /api/users/auth/send-mail-verification:
    post:
      tags:
        - auth
      description: Sends an email verification email to the user's email address
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
        required: true
      responses:
        "200":
          description: "Success: Email verification email sent"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-3"
        "400":
          description: "Bad Request: Invalid input or missing fields"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
  /api/users/auth/login/2fa:
    post:
      tags:
        - auth
      description: Verify a user's 2FA code sent during login
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - code
              description: 6-digit code sent to user email or app
              properties:
                code:
                  type: string
                  minLength: 6
                  maxLength: 6
        required: true
        description: 6-digit code sent to user email or app
      parameters:
        - schema:
            type: integer
          in: cookie
          name: pending_2fa_uid
          required: true
          description: User ID for pending 2FA stored in cookie
      responses:
        "200":
          description: Login successful
          content:
            application/json:
              schema:
                description: Login successful
                type: object
                required:
                  - accessToken
                  - id
                properties:
                  accessToken:
                    type: string
                  id:
                    type: integer
        "401":
          description: "Unauthorized: Invalid token or code"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
  /api/users/auth/oauth/42:
    get:
      tags:
        - OAuth
      description: Redirects the user to the 42 authorize page
      responses:
        "200":
          description: Default Response
  /api/users/auth/oauth/42/callback:
    get:
      tags:
        - OAuth
      description: "Handles the OAuth2 callback from 42. Verifies the authorization
        code and state,\t\t retrieves the user information from 42, and either
        logs in an existing user or signs up a new user. \t\t`Stores refresh
        token in cookies` if login/signup is successful and `put the user's id
        in query`, \t\tor returns a two-factor authentication boolean if the
        user has enabled 2FA indicating \t\t that the authentication process
        continues by calling the `two-factor login` endpoint. "
      parameters:
        - schema:
            type: string
            example: a3f9c8e2b4d74e0c9f...
          in: query
          name: code
          required: true
          description: The code you received as a response of `GET api/users/auth/oauth/42`
        - schema:
            type: string
            example: a3f9c8e2b4d74e0c9f...
          in: query
          name: state
          required: true
          description: Unguessable string provided in the in by backend for verification
            `GET api/users/auth/oauth/42`
      responses:
        "302":
          description: Redirects to frontend after OAuth login. May include `id` query or
            `twoFactorRequired` flag.
          headers:
            type:
              schema:
                "0": o
                "1": b
                "2": j
                "3": e
                "4": c
                "5": t
            required:
              schema:
                "0": location
            properties:
              schema:
                location:
                  type: string
                  description: Frontend URL with query parameters (user id or 2FA flag)
                  example: https://frontend.example.com/?id=123
          content:
            application/json:
              schema:
                type: object
                description: Redirects to frontend after OAuth login. May include `id` query or
                  `twoFactorRequired` flag.
                additionalProperties: true
        "500":
          description: Default Response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Default Response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
  /api/users/auth/reset-password:
    post:
      tags:
        - auth
      description: Sends a password reset email to the user's email address. If the
        email is not found a 200 is still returned
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
        required: true
      responses:
        "200":
          description: "Success: Password reset email sent"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-3"
        "400":
          description: "Bad Request: Invalid input or missing fields"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
    get:
      tags:
        - auth
      description: "Verifies a user's password reset token and redirects to the reset
        password page where they can reset their password "
      parameters:
        - schema:
            type: string
          in: query
          name: token
      responses:
        "302":
          description: Redirects to the reset password page
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-3"
        "400":
          description: "Bad Request: Invalid input or missing fields"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/def-1"
tags:
  - name: auth
    description: Auth endpoints
  - name: user
    description: User endpoints
  - name: matches
    description: Matches endpoints
